---
order : 16
---
# MySQL进阶 - 视图
## 介绍和基本语法

### 介绍

视图View是一种虚拟存在的表，视图中的数据并不在数据库中实际存在，行和列数据来自定义视图中使用的表，并且是在使用视图时动态生成的。

简单的来说，视图不保存数据，只是保存了查询的SQL逻辑，不保存查询的结果。所以我们在创建视图的时候，主要的工作就落在创建这条SQL查询语句上。
::: info 简单理解
可以理解为给SQL语句设置别名，我们在使用的时候可以直接使用别名进行子查询、联合查询等操作。
:::
### 操作语法

- 创建
```sql
CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH[CASCADED | LOCAL] CHECK OPTION];
```
- 查询
```sql
-- 查看创建视图语句
SHOW CREATE VIEW 视图名称;
-- 查看视图数据
SELECT * FROM 视图名称;
```

视图就是一张逻辑SQL查询的临时表，我们可以直接按照表的操作来操作视图。
- 修改
```sql
-- 方法一：和创建视图一致，但是需要保证OR REPLACE关键字，说明是替换原来的视图
CREATE [OR REPLACE] VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH[CASCADED | LOCAL] CHECK OPTION];

-- 方法二
ALTER VIEW 视图名称[(列名列表)] AS SELECT语句 [WITH[CASCADED | LOCAL] CHECK OPTION];
```
- 删除
```sql
DROP VIEW [IF EXISTS] 视图名称 [,视图名称...];
```
## 检查选项

当使用WITH CHECK OPTION 子句创建视图时，MySQL会通过视图检查正在更改的每个行，例如 插入、删除 更新，以使其符合视图的定义。MySQL允许基于另一个视图创建视图，他还会检查依赖视图中的规则以保持一致性。为了确定检查的范围，MySQL提供了两个选项：`CASCADED`、`LOCAL`，默认值为`CASCADED`。

CASCADED会强制检查当前视图和其依赖的视图的筛选条件。

LOCAL会检查当前视图，并且检查定义检查条件的依赖的视图。

::: info 简单理解
可以简单的理解为CASCADED是强制检查所有相关的视图，无论是否定义，而LOCAL只会检查定义检查条件的视图。
:::

## 更新及作用

### 视图的更新

要使视图可以更新，视图中的行与基础表中的行之间必须存在一对一的关系，如果视图包含了以下任意一项，则该视图就不可更新：
1. 聚合函数或者窗口函数(SUM()、MIN()、MAX()、COUNT()等)；
2. DISTINCT
3. GROUP BY
4. HAVING
5. UNION 或者 UNION ALL

### 视图的作用

- 简单

视图不仅可以简化用户对数据的理解，也可以简化他们的操作，那些被经常使用的查询可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的查询条件。

- 安全

数据库可以授权，但是不能授权到数据库特定行和特定的列上。通过视图用户只能查询和修改他们所能见到的数据。

