---
order : 6
---
# 事务

事务是一组操作的集合，他是一个不可分隔的工作单位，事务会把所有的操作作为一个整体一起向系统提交或者撤销操作请求，即这些操作要么同时成功，要么同时失败。

## 事务操作

- 查看/设置事务提交方式
```sql
SELECT @@autocommit;
SET @@autocommit = 0;
```

::: info 说明
这里的@@autocommit 属性的值有两种：
- 1：则开启自动提交
- 0：关闭自动提交，此时事务执行完毕时，需要我们使用指令进行提交。
:::
- 开启事务

```sql
START TRANSACTION;
-- 或者
BEGIN;
```
- 提交事务
```sql
COMMIT;
```
- 回滚事务
```sql
ROLLBACK;
```

## 事务的四大特性
::: tip 提示
事务的ACID特性，是面试中经常被问到的一个知识点，也是实际业务中容易出错的一个点，需要认真学习。
:::
- 原子性(Atomicity):事务是不可分割的最小操作单元，要么全部成功，要么全部失败。
- 一致性(Consistency):事务完成时，必须使得所有的数据都保持一致状态。
- 隔离性(Isolation):数据库提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。
- 持久性(Durability):事务一旦提交或者回滚，它对数据库中数据的改变就是永久的。

## 事务并发问题

在单线程环境下，对数据库的任何操作都是安全的。但是在并发环境下，对数据库进行事务操作，可能会产生一系列的问题。

|问题|描述|
|:---:|:---:|
|脏读|一个事务读到另外一个事务还没有提交的数据。|
|不可重复读|一个事务先后读取同一条记录，但是两次读取的数据不一致|
|幻读|一个事务按照指定条件查询数据时，没有对应的数据记录值，但是在插入操作时，又发现数据已经存在。删除现象也是如此|

## 事务的隔离级别

|隔离级别|脏读|不可重复读|幻读|
|:---:|:---:|:---:|:---:|
|Read Uncommitted(读未提交)|✅|✅|✅|
|Read Committed(读已提交)|❌|✅|✅|
|Repeatable Read<Badge text="默认" type="danger" />(可重复读)|❌|❌|✅|
|Serializable(串行化)|❌|❌|❌|


- 查看事务的隔离级别
```sql
SELECT @@TRANSACTION_ISOLATION;
```
- 设置事务的隔离级别
```sql
SET [Session|Global] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE}
```

::: warning 注意
事务的隔离级别越高，数据的安全性也越高，但是性能越低。
:::